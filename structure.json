{
  "project_manifest": {
    "name": "Universal Office",
    "version": "2.4.0",
    "last_updated": "2026-02-22",
    "bcp_compliance": "100%",
    "operational_status": "OPERATIONAL — Phase 6.5 QC fixes verified through full liturgical year stress test"
  },

  "documentation_debt": {
    "severity": "HIGH",
    "status": "⚠️ OUT OF SYNC",
    "affected_files": [
      "ADVENT_DOCUMENTATION.md",
      "EPIPHANY_DOCUMENTATION.md",
      "LENT_DOCUMENTATION.md",
      "EASTER_DOCUMENTATION.md",
      "STATIC_OFFICES_DOCUMENTATION.md",
      "ORDINARY_TIME_DOCUMENTATION.md",
      "BCP_PROPERS_DOCUMENTATION.md",
      "SESSION_CHECKPOINT_2026-02-17.md",
      "SESSION_CHECKPOINT_2026-02-17_evening.md"
    ],
    "reason": "All .md documentation was written against the pre-modularization monolithic index.html. None reflects the four-file modular architecture, Phase 6.4 ecumenical reorganization, or Phase 6.5 QC fixes.",
    "action": "Full documentation rewrite required before Phase 7.0 begins."
  },

  "active_modules": {
    "index.html": {
      "role": "Markup and DOM structure only",
      "lines": "~1165",
      "contains_logic": false,
      "status": "Current",
      "script_load_order": [
        "js/calendar-engine.js",
        "js/scripture-resolver.js",
        "js/office-ui.js",
        "js/prayers.js",
        "js/tooltip.js"
      ]
    },
    "js/office-ui.js": {
      "role": "All Daily Office UI logic",
      "status": "Verified — Modularized (2026-02-22)",
      "primary_functions": [
        "init()",
        "renderOffice()",
        "toggleSidebar()",
        "selectMode()",
        "changeDate() / resetDate() / setCustomDate()",
        "updateSidebarForOffice()",
        "updateUI() / updateSeasonalTheme()",
        "saveSettings() / loadSettings()",
        "toggleBcpOnly()",
        "backToSplash()"
      ],
      "rubric_loop_handlers": [
        "VARIABLE_OPENING — resolves bcp-opening-${season}, fallback to bcp-opening-general",
        "VARIABLE_ANTIPHON — resolves antiphon_mp or antiphon_ep from dailyData",
        "VARIABLE_PSALM — renders appointed psalms with optional Gloria Patri",
        "VARIABLE_READING_OT — OT lesson from independent morning or evening chain",
        "VARIABLE_READING_EPISTLE — Epistle from independent morning or evening chain",
        "VARIABLE_READING_GOSPEL — Gospel subject to gospelPlacement setting",
        "VARIABLE_CANTICLE1 — Te Deum (MP) / Magnificat (EP)",
        "VARIABLE_CANTICLE2 — Benedictus (MP) / Nunc Dimittis (EP)",
        "VARIABLE_COLLECT — collect lookup with manual ID mappings; triggers Examen and Kyrie Pantocrator"
      ],
      "key_logic_notes": [
        "Reading resolution uses independent morning/evening chains — no shared intermediate variables between MP and EP",
        "Theotokion uses two-step lookup: coptic-theotokion-${season} with fallback to coptic-theotokion",
        "Examen text: \\n\\n converted to <br><br>, rendered in <div style='white-space:normal'>",
        "toggleSidebar() propagates sidebar-hidden class to both #settings-panel and #main-content",
        "CalendarEngine.init() is called explicitly in init() after JSON loads, before fetchLectionaryData()"
      ]
    },
    "js/calendar-engine.js": {
      "role": "All date and liturgical calendar logic",
      "lines": 512,
      "status": "Current (2026-02-17)",
      "global_api": "window.CalendarEngine",
      "public_methods": [
        "init() — loads bcp-propers.json; must be called before fetchLectionaryData()",
        "getSeasonAndFile(date) — returns { season, file, liturgicalColor, litYear }",
        "getLiturgicalYear(date) — returns 'year1' or 'year2'",
        "getCurrentProper(date) — returns Proper number 3–29",
        "fetchLectionaryData(date) — returns daily entry object from seasonal JSON",
        "getCurrentDate()",
        "setCurrentDate(date)",
        "changeDate(days)",
        "resetDate()",
        "formatDateForLookup(date) — returns 'February 17, 2026'",
        "formatDateISO(date) — returns '2026-02-17'"
      ]
    },
    "js/scripture-resolver.js": {
      "role": "Scripture text fetching, citation parsing, LRU book cache",
      "lines": 254,
      "status": "Current (2026-02-17)",
      "global_function": "getScriptureText(citation)",
      "cache": "LRU — max 20 Bible books",
      "example_citations": [
        "Isaiah 40:12-23",
        "Psalm 119:105-112",
        "Joel 2:1-2, 12-17"
      ]
    },
    "css/office.css": {
      "role": "All application styles — theming, sidebar, layout, print",
      "status": "Verified — Modularized (2026-02-22)",
      "key_rules": [
        "#settings-panel — sidebar panel, transition: left 0.3s ease",
        "#settings-panel.sidebar-hidden — left: -300px",
        "#main-content — flex content area, transition: margin-left 0.3s ease",
        "#main-content.sidebar-hidden — margin-left: 36px",
        "#sidebar-toggle — 36px fixed toggle column",
        "CSS custom properties on :root — --gold, --accent, --rubric, --bg-color, etc.",
        "@media print — removes all UI chrome, optimizes for paper output"
      ]
    }
  },

  "data_summary": {
    "note": "Individual data files are not enumerated here. See historical structure file for full listings.",
    "data/bible/": "[600+ Scripture files across NT, OT, ET, SY, AR, ODES subdirectories]",
    "data/season/": "[9 seasonal JSON files — 353 total BCP 1979 daily lectionary entries, Year One and Year Two tracks]",
    "data/saints/": "[12 monthly JSON files — 365+ saint commemorations]",
    "data/components.json": "All renderable liturgical text components, keyed by ID",
    "data/rubrics.json": "Office sequence definitions (rubric arrays per office ID)",
    "data/season/bcp-propers.json": "Proper 1–29 reference table, consumed by CalendarEngine.init()"
  },

  "recent_logic_changes": [
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "VARIABLE_COLLECT",
      "change": "Manual collect ID mapping added",
      "detail": "collect-transfiguration → collect-the-transfiguration-of-our-lord",
      "reason": "Naming mismatch between seasonal JSON collect field and components.json entry ID"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "renderOffice() — reading resolution",
      "change": "Split shared reading variables into independent morning and evening chains",
      "detail": "morningOT/morningEpistle/morningGospel resolved exclusively from _mp_ keys; eveningOT/eveningEpistle/eveningGospel resolved exclusively from _ep_ keys",
      "reason": "Cross-contamination — EP keys were polluting MP resolution via shared intermediate variables"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "init()",
      "change": "CalendarEngine.init() call inserted between JSON data load and fetchLectionaryData()",
      "reason": "Race condition — bcp-propers.json was not guaranteed loaded before lectionary fetch"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "toggleSidebar()",
      "change": "sidebar-hidden class now toggled on #main-content in addition to #settings-panel",
      "reason": "Main content area did not reflow when sidebar was hidden"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "VARIABLE_COLLECT — Examen block",
      "change": "Examen text rendered with \\n\\n → <br><br> replacement inside <div style='white-space:normal'>",
      "reason": "Paragraph breaks in source text were collapsed by default span/white-space handling"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "Marian components block",
      "change": "Theotokion lookup changed to two-step: coptic-theotokion-${season} with fallback to coptic-theotokion",
      "reason": "Seasonal Theotokion variants were never resolved; only the generic entry was ever used"
    },
    {
      "date": "2026-02-22",
      "file": "js/office-ui.js",
      "handler": "Rubric sequence loop",
      "change": "VARIABLE_ANTIPHON handler block added",
      "reason": "Antiphons were rendered outside the sequence loop; handler enables correct positional placement within the rubric"
    },
    {
      "date": "2026-02-22",
      "file": "css/office.css",
      "handler": "#main-content",
      "change": "Added transition: margin-left 0.3s ease to base rule; added #main-content.sidebar-hidden { margin-left: 36px }",
      "reason": "Sidebar toggle had no corresponding layout shift on the main content area"
    }
  ],

  "roadmap_summary": {
    "completed": "Phases 6.1–6.5 (BCP lectionary, modularization, ecumenical organization, QC fixes)",
    "next_required": "Phase 6.6 — Documentation rewrite (all .md files out of sync)",
    "next_planned": "Phase 6.7 — Performance polish (timezone warning, LRU for seasonal cache, prefetch, service worker)",
    "future": "Phase 7.0 — Multi-tradition architecture (Byzantine, Coptic, CoE, Ethiopian); Phase 8.0 — Mobile app"
  }
}