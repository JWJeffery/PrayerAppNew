<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Universal Office</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=IM+Fell+English:ital@0;1&family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/office.css">
</head>
<body id="app-body" class="dark-mode">

<!-- ── Splash Screen ─────────────────────────────────────────────────────── -->
<div id="splash-bg"></div>
<div id="mode-selection">
    <h1>Welcome to The Universal Office</h1>
    <p>Select your mode:</p>
    <button class="mode-btn" onclick="selectMode('daily')">Daily Office</button>
    <button class="mode-btn" onclick="selectMode('prayers')">The Book of Needs</button>
    <div style="margin-top:32px; border-top:1px solid rgba(201,168,76,0.25); padding-top:18px;">
        <a href="https://musingsancientandmodern.substack.com/" target="_blank" style="text-decoration:none; display:block; text-align:center;">
            <span style="font-family:'Cinzel',serif; font-size:0.68em; letter-spacing:0.18em; text-transform:uppercase; color:#a89878; display:block; margin-bottom:5px;">Sponsored by</span>
            <span style="font-family:'Cinzel Decorative','Cinzel',serif; font-size:0.95em; letter-spacing:0.08em; color:#c0392b; text-shadow:0 0 8px rgba(201,168,76,0.35), 0 1px 3px rgba(0,0,0,0.8); display:block;">Musings, Ancient and Modern</span>
        </a>
    </div>
</div>

<!-- ── Daily Office ──────────────────────────────────────────────────────── -->
<div id="daily-office-section">

    <!-- Sidebar toggle tab -->
    <div id="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Settings">
        <span class="toggle-cross">☩</span>
        <div class="toggle-dots"><span></span><span></span><span></span></div>
        <span class="toggle-cross">☩</span>
    </div>

    <!-- Settings panel -->
    <div id="settings-panel">
        <h3 style="color:var(--gold); font-family:'Cinzel',serif; font-size:1.15em; letter-spacing:0.08em;">Office Settings</h3>

        <!-- Date navigator -->
        <div class="ordo-control">
            <strong>Liturgical Ordo</strong>
            <div class="ordo-date" id="display-date">Loading...</div>
            <div class="ordo-buttons">
                <button class="ordo-btn" onclick="changeDate(-1)">Prev</button>
                <button class="ordo-btn" onclick="resetDate()">Today</button>
                <button class="ordo-btn" onclick="changeDate(1)">Next</button>
            </div>
            <label for="date-picker" style="display:block; color:var(--gold); font-size:0.8em; margin-top:10px;">Select Date:</label>
            <input type="date" id="date-picker" style="margin-top:5px; width:100%; padding:5px; background:#333; color:white; border:1px solid #555; border-radius:4px; box-sizing:border-box;" onchange="setCustomDate(this.value)">
            <div id="calendar-info" style="font-size:0.7em; color:var(--gold); margin-top:10px;">Exploring the Ordo...</div>
        </div>

        <!-- Time of Day -->
        <div class="setting-group">
            <strong>Time of Day:</strong>
            <label><input type="radio" name="office-time" value="morning-office" onchange="updateSidebarForOffice(); renderOffice(); saveSettings()" checked> Morning Prayer</label>
            <label><input type="radio" name="office-time" value="noonday-office"  onchange="updateSidebarForOffice(); renderOffice(); saveSettings()"> Noonday Prayer</label>
            <label><input type="radio" name="office-time" value="evening-office"  onchange="updateSidebarForOffice(); renderOffice(); saveSettings()"> Evening Prayer</label>
            <label><input type="radio" name="office-time" value="compline-office" onchange="updateSidebarForOffice(); renderOffice(); saveSettings()"> Compline</label>
        </div>

        <!-- Appearance -->
        <div class="setting-group">
            <strong>Appearance:</strong>
            <label><input type="checkbox" id="toggle-dark"     onchange="updateUI(); saveSettings()" checked> Vespers Mode (Dark)</label>
            <label style="margin-top:8px;"><input type="checkbox" id="toggle-bcp-only" onchange="toggleBcpOnly(); saveSettings()"> BCP Only Mode</label>
        </div>

        <!-- Liturgical Settings -->
        <div class="setting-group">
            <strong>Liturgical Settings:</strong>
            <div class="nested-group">
                <strong style="color:#aaa; font-size:1em;">Language &amp; Rite</strong>
                <label><input type="radio" name="rite" value="rite1" onchange="renderOffice(); saveSettings()"> Rite I (Traditional)</label>
                <label><input type="radio" name="rite" value="rite2" onchange="renderOffice(); saveSettings()" checked> Rite II (Contemporary)</label>
            </div>
            <div class="nested-group" style="margin-top:8px;">
                <strong style="color:#aaa; font-size:1em;">Officiant</strong>
                <label><input type="radio" name="minister" value="priest" onchange="renderOffice(); saveSettings()"> Priest</label>
                <label><input type="radio" name="minister" value="lay"    onchange="renderOffice(); saveSettings()" checked> Layperson</label>
            </div>
            <div class="nested-group" style="margin-top:8px;">
                <strong style="color:#aaa; font-size:1em;">Creed</strong>
                <select id="creed-type" onchange="renderOffice(); saveSettings()" style="margin-top:4px; width:auto; min-width:160px; padding:4px 8px; background:#333; color:white; border:1px solid #555; border-radius:4px;">
                    <option value="bcp-creed-apostles">Apostles' Creed</option>
                    <option value="bcp-creed-nicene">Nicene Creed</option>
                </select>
            </div>
            <div class="nested-group" style="margin-top:8px;">
                <strong style="color:#aaa; font-size:1em;">Lectionary</strong>
                <label style="margin-top:4px;"><input type="radio" name="gospel-placement" value="morning" onchange="renderOffice(); saveSettings()"> Gospel in Morning</label>
                <label><input type="radio" name="gospel-placement" value="evening" onchange="renderOffice(); saveSettings()" checked> Gospel in Evening</label>
                <label><input type="radio" name="gospel-placement" value="both"    onchange="renderOffice(); saveSettings()"> Gospel in Both</label>
                <label style="margin-top:6px;"><input type="checkbox" id="toggle-30day-psalter" onchange="renderOffice(); saveSettings()"> 30-Day Psalter</label>
            </div>
        </div>

        <!-- Opening Devotions (ecumenical) -->
        <div class="setting-group" id="ecumenical-devotions-section">
            <strong>Opening Devotions: <span class="info-btn" data-tip="These devotions render before the office begins. They are hidden when BCP Only Mode is active.">i</span></strong>
            <div class="nested-group">
                <strong style="color:#aaa; font-size:1em;">Coptic Orthodox</strong>
                <label><input type="checkbox" id="toggle-agpeya-opening" onchange="renderOffice(); saveSettings()"> Agpeya Opening</label>
            </div>
            <div class="nested-group" style="margin-top:8px;">
                <strong style="color:#aaa; font-size:1em;">Church of the East</strong>
                <label><input type="checkbox" id="toggle-east-syriac-hours" onchange="renderOffice(); saveSettings()"> Prayer of the Hours <span class="info-btn" data-tip="The Hudra is the Church of the East's canonical prayer book, equivalent to the Divine Office.">i</span></label>
            </div>
            <div class="nested-group" style="margin-top:8px;">
                <strong style="color:#aaa; font-size:1em;">Marian Element</strong>
                <label style="margin-top:4px; font-size:0.85em; color:#aaa;">Element:</label>
                <label><input type="radio" name="marian-element" value="none"      onchange="renderOffice(); saveSettings()" checked> None</label>
                <label><input type="radio" name="marian-element" value="antiphon"  onchange="renderOffice(); saveSettings()"> BCP Seasonal Antiphon</label>
                <label><input type="radio" name="marian-element" value="theotokion" onchange="renderOffice(); saveSettings()"> Theotokion <span class="info-btn" data-tip="Coptic hymn honouring Mary as Theotokos (God-bearer). Sung at the close of the canonical hours.">i</span></label>
                <label><input type="radio" name="marian-element" value="both"      onchange="renderOffice(); saveSettings()"> Both</label>
                <label style="margin-top:6px; font-size:0.85em; color:#aaa;">Position:</label>
                <label><input type="radio" name="marian-antiphon-pos" value="before" onchange="renderOffice(); saveSettings()" checked> Before office</label>
                <label><input type="radio" name="marian-antiphon-pos" value="after"  onchange="renderOffice(); saveSettings()"> After office</label>
            </div>
        </div>

        <!-- During the Office -->
        <div class="setting-group" id="during-office-section">
            <strong>During the Office: <span class="info-btn" data-tip="These elements are inserted at their proper liturgical position within the office. Hidden when BCP Only Mode is active.">i</span></strong>
            <label><input type="checkbox" id="toggle-gloria-patri"          onchange="renderOffice(); saveSettings()" checked> Gloria Patri <span class="info-btn" data-tip="The Lesser Doxology sung after each Psalm: 'Glory to the Father, and to the Son, and to the Holy Spirit...'">i</span></label>
            <label style="margin-top:4px;"><input type="checkbox" id="toggle-angelus"    onchange="renderOffice(); saveSettings()"> Angelus <span class="info-btn" data-tip="Roman Catholic devotion recalling the Incarnation, traditionally prayed at morning, noon, and evening. Placed before the Invitatory.">i</span></label>
            <label><input type="checkbox" id="toggle-trisagion"              onchange="renderOffice(); saveSettings()"> Trisagion <span class="info-btn" data-tip="'Holy God, Holy Mighty, Holy Immortal, have mercy on us.' Ancient Byzantine prayer placed after the Absolution.">i</span></label>
            <label><input type="checkbox" id="toggle-prayer-before-reading"  onchange="renderOffice(); saveSettings()"> Prayer Before Reading <span class="info-btn" data-tip="Orthodox prayer asking illumination before the Old Testament lesson is read.">i</span></label>
        </div>

        <!-- After the Office -->
        <div class="setting-group" id="closing-devotions-section">
            <strong>After the Office: <span class="info-btn" data-tip="These devotions are appended after the office concludes. Hidden when BCP Only Mode is active.">i</span></strong>
            <label><input type="checkbox" id="toggle-examen"                 onchange="renderOffice(); saveSettings()"> The Examen <span class="info-btn" data-tip="The Ignatian Examination of Conscience — a prayerful review of the day. Appears only in Compline.">i</span></label>
            <label><input type="checkbox" id="toggle-kyrie-pantocrator"      onchange="renderOffice(); saveSettings()"> Kyrie Pantocrator <span class="info-btn" data-tip="'Lord Almighty' — a Byzantine litany of supplication placed after the Collect.">i</span></label>
            <label style="margin-top:6px;"><input type="checkbox" id="toggle-suffrages" onchange="renderOffice(); saveSettings()" checked> Suffrages</label>
            <label><input type="checkbox" id="toggle-litany"                 onchange="renderOffice(); saveSettings()"> The Great Litany</label>
            <label><input type="checkbox" id="toggle-general-thanksgiving"   onchange="renderOffice(); saveSettings()"> General Thanksgiving</label>
            <label><input type="checkbox" id="toggle-chrysostom"             onchange="renderOffice(); saveSettings()"> Prayer of St. Chrysostom</label>
        </div>
    </div><!-- /settings-panel -->

    <!-- Main content area -->
    <div id="main-content">
        <button onclick="backToSplash()" style="position:fixed; top:12px; right:16px; background:transparent; color:var(--gold); border:1px solid rgba(201,168,76,0.4); padding:4px 14px; font-family:'Cinzel',serif; font-size:0.7em; letter-spacing:0.12em; text-transform:uppercase; border-radius:2px; cursor:pointer; opacity:0.6; z-index:200; transition:opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">Back to Modes</button>
        <h1>The Universal Office</h1>
        <div id="office-display"></div>
        <div class="saint-section">
            <div class="saint-section-divider"><div class="sdiv-left"></div><span>Commemorations</span><div class="sdiv-right"></div></div>
            <h2 id="date-header" style="display:none;"></h2>
            <div id="saint-display" class="saint-grid"></div>
        </div>
    </div>

</div><!-- /daily-office-section -->

<!-- ── Book of Needs ─────────────────────────────────────────────────────── -->
<div id="individual-prayers-section">
    <div id="prayer-selection">
        <h1 style="font-family:'Cinzel Decorative','Cinzel',serif; color:var(--gold); font-size:1.9em; letter-spacing:0.06em; margin-bottom:0.3em;">The Book of Needs</h1>
        <p style="font-family:'Cinzel',serif; font-size:0.78em; letter-spacing:0.15em; text-transform:uppercase; color:#a89878; margin-bottom:28px;">Select a Prayer</p>

        <div class="prayer-select-wrapper" id="prayer-select-wrapper">
            <div class="prayer-select-trigger" id="prayer-select-trigger" onclick="togglePrayerDropdown()">
                <span id="prayer-select-label">— Choose a Prayer —</span>
            </div>
            <div class="prayer-select-list" id="prayer-select-list">

                <div class="prayer-optgroup-label">Eucharist: Preparation &amp; Spiritual Communion</div>
                <div class="prayer-option" data-value="prayer-humble-access"  onclick="selectPrayer(this)">Prayer of Humble Access (BCP)</div>
                <div class="prayer-option" data-value="spiritual-communion"   onclick="selectPrayer(this)">Act of Spiritual Communion</div>

                <div class="prayer-optgroup-label">Eucharist: Thanksgiving After Communion</div>
                <div class="prayer-option" data-value="thanksgiving-aquinas"  onclick="selectPrayer(this)">Thanksgiving (After St. Thomas Aquinas)</div>
                <div class="prayer-option" data-value="thanksgiving-hooker"   onclick="selectPrayer(this)">Thanksgiving (After Richard Hooker)</div>
                <div class="prayer-option" data-value="thanksgiving-andrewes" onclick="selectPrayer(this)">Self-Oblation (After Lancelot Andrewes)</div>
                <div class="prayer-option" data-value="thanksgiving-basil"    onclick="selectPrayer(this)">From the Liturgy of Saint Basil</div>

                <div class="prayer-optgroup-label">Eucharist: Adoration &amp; Benediction</div>
                <div class="prayer-option" data-value="o-salutaris"    onclick="selectPrayer(this)">O Salutaris (St. Thomas Aquinas)</div>
                <div class="prayer-option" data-value="tantum-ergo"    onclick="selectPrayer(this)">Tantum Ergo (St. Thomas Aquinas)</div>
                <div class="prayer-option" data-value="divine-praises" onclick="selectPrayer(this)">The Divine Praises</div>
                <div class="prayer-option" data-value="anima-christi"  onclick="selectPrayer(this)">Anima Christi (tr. John Henry Newman)</div>

                <div class="prayer-optgroup-label">Eucharist: Personal Devotions</div>
                <div class="prayer-option" data-value="to-blessed-virgin"   onclick="selectPrayer(this)">To the Blessed Virgin Mary</div>
                <div class="prayer-option" data-value="to-saint-joseph"     onclick="selectPrayer(this)">To Saint Joseph</div>
                <div class="prayer-option" data-value="in-sorrow-or-trouble" onclick="selectPrayer(this)">In Sorrow or Trouble</div>
                <div class="prayer-option" data-value="ave-regina"          onclick="selectPrayer(this)">Ave Regina Caelorum</div>

                <div class="prayer-optgroup-label">Eucharist: Contrition &amp; Repentance</div>
                <div class="prayer-option" data-value="act-of-contrition" onclick="selectPrayer(this)">Act of Contrition</div>
                <div class="prayer-option" data-value="after-neglect"     onclick="selectPrayer(this)">After Neglect or Misuse of the Sacrament</div>

                <div class="prayer-optgroup-label">Prayers of Lancelot Andrewes</div>
                <div class="prayer-option" data-value="andrewes-commendation"  onclick="selectPrayer(this)">Commendation</div>
                <div class="prayer-option" data-value="andrewes-thanksgiving"  onclick="selectPrayer(this)">Thanksgiving</div>
                <div class="prayer-option" data-value="andrewes-penitence"     onclick="selectPrayer(this)">Penitence</div>
                <div class="prayer-option" data-value="andrewes-petition"      onclick="selectPrayer(this)">Petition</div>

                <div class="prayer-optgroup-label">General Intercessions</div>
                <div class="prayer-option" data-value="prayer-for-the-sick"    onclick="selectPrayer(this)">Prayer for the Sick</div>
                <div class="prayer-option" data-value="prayer-for-peace"       onclick="selectPrayer(this)">Prayer for Peace</div>
                <div class="prayer-option" data-value="prayer-for-unity"       onclick="selectPrayer(this)">Prayer for Unity</div>
                <div class="prayer-option" data-value="prayer-for-mission"     onclick="selectPrayer(this)">Prayer for Mission</div>
                <div class="prayer-option" data-value="prayer-for-guidance"    onclick="selectPrayer(this)">Prayer for Guidance</div>
                <div class="prayer-option" data-value="prayer-for-the-church"  onclick="selectPrayer(this)">Prayer for the Church</div>
                <div class="prayer-option" data-value="prayer-for-the-world"   onclick="selectPrayer(this)">Prayer for the World</div>

                <div class="prayer-optgroup-label">For Ministers: Journey to Church</div>
                <div class="prayer-option" data-value="minister-journey-bcp"      onclick="selectPrayer(this)">On the Way to Church (Anglican)</div>
                <div class="prayer-option" data-value="minister-journey-orthodox" onclick="selectPrayer(this)">On the Way to Church (Orthodox)</div>

                <div class="prayer-optgroup-label">For Ministers: Before Entering Church</div>
                <div class="prayer-option" data-value="minister-entering-bcp"      onclick="selectPrayer(this)">Before Entering Church (Anglican)</div>
                <div class="prayer-option" data-value="minister-entering-orthodox" onclick="selectPrayer(this)">Before Entering Church (Orthodox)</div>

                <div class="prayer-optgroup-label">For Ministers: Vesting Prayers</div>
                <div class="prayer-option" data-value="vesting-amice"                 onclick="selectPrayer(this)">Vesting: The Amice</div>
                <div class="prayer-option" data-value="vesting-alb"                   onclick="selectPrayer(this)">Vesting: The Alb</div>
                <div class="prayer-option" data-value="vesting-cincture"              onclick="selectPrayer(this)">Vesting: The Cincture</div>
                <div class="prayer-option" data-value="vesting-stole-deacon"          onclick="selectPrayer(this)">Vesting: The Stole (Deacon)</div>
                <div class="prayer-option" data-value="vesting-stole-priest"          onclick="selectPrayer(this)">Vesting: The Stole (Priest)</div>
                <div class="prayer-option" data-value="vesting-chasuble"              onclick="selectPrayer(this)">Vesting: The Chasuble</div>
                <div class="prayer-option" data-value="vesting-orthodox-epitrachelion" onclick="selectPrayer(this)">Vesting: The Epitrachelion (Orthodox)</div>
                <div class="prayer-option" data-value="vesting-orthodox-phailonion"   onclick="selectPrayer(this)">Vesting: The Phelonion (Orthodox)</div>
                <div class="prayer-option" data-value="vesting-orthodox-full"         onclick="selectPrayer(this)">Vesting Prayers: Full Orthodox Sequence</div>

                <div class="prayer-optgroup-label">For Ministers: Before Serving</div>
                <div class="prayer-option" data-value="minister-before-serving-bcp"      onclick="selectPrayer(this)">Before Serving (Anglican)</div>
                <div class="prayer-option" data-value="minister-before-serving-orthodox" onclick="selectPrayer(this)">Before the Divine Liturgy (Orthodox)</div>
                <div class="prayer-option" data-value="minister-before-serving-deacon"   onclick="selectPrayer(this)">For a Deacon Before the Liturgy</div>

                <div class="prayer-optgroup-label">For Ministers: After Serving</div>
                <div class="prayer-option" data-value="minister-after-serving-bcp"      onclick="selectPrayer(this)">Thanksgiving After Serving (Anglican)</div>
                <div class="prayer-option" data-value="minister-after-serving-orthodox" onclick="selectPrayer(this)">Thanksgiving After the Liturgy (Orthodox)</div>

            </div>
        </div>

        <input type="hidden" id="prayer-dropdown" value="">
        <br>
        <button class="mode-btn" onclick="showSinglePrayer()" style="margin-top:20px;">Display Prayer</button>
        <button class="mode-btn" onclick="backToSplash()"     style="margin-top:12px;">Back to Modes</button>
    </div><!-- /prayer-selection -->

    <div id="prayer-display" style="display:none; margin-top:40px; background:transparent; width:100%; max-width:800px; padding-bottom:100px; box-sizing:border-box;">
        <div id="single-prayer-content"></div>
    </div>

    <div id="prayer-back-bar" style="display:none; position:fixed; bottom:0; left:0; right:0; text-align:center; padding:16px 0 20px; background:linear-gradient(transparent, rgba(30,18,8,0.97) 40%); z-index:300;">
        <button class="mode-btn" onclick="backToPrayerDropdown()">Back to Selection</button>
    </div>
</div><!-- /individual-prayers-section -->

<!-- ── Tooltip ───────────────────────────────────────────────────────────── -->
<div id="uo-tooltip"></div>

<!-- ── Scripts ───────────────────────────────────────────────────────────── -->
<script src="js/calendar-engine.js"></script>
<script src="js/scripture-resolver.js"></script>
<script src="js/office-ui.js"></script>
<script src="js/prayers.js"></script>
<script src="js/tooltip.js"></script>

</body>
</html>