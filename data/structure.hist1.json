{
  "project_manifest": {
    "name": "Universal Office (Prayer App New)",
    "version": "2.4.0",
    "description": "A comprehensive digital Daily Office designed for Anglicans and those in communion with them, with ecumenical elements from Catholic, Byzantine Orthodox, Oriental Orthodox, Coptic, and Church of the East traditions. Ecumenical devotions are positionally placed according to their liturgical function. Phase 7.0 will add full canonical hours for each Eastern tradition.",
    "theological_vision": "As part of 'the one, holy, catholic, and apostolic Church,' the app aims to help users become more like Jesus through sacraments and prayer, drawing from the Holy Fathers.",
    "current_phase": "Phase 6: Implementation Complete — QC Fixes and UI Refinements Applied",
    "last_major_update": "2026-02-22"
  },
  "documentation_debt_warning": {
    "severity": "HIGH",
    "status": "⚠️ OUT OF SYNC",
    "flag": "DOCUMENTATION REWRITE REQUIRED",
    "description": "All external documentation files (ADVENT_DOCUMENTATION.md, EPIPHANY_DOCUMENTATION.md, LENT_DOCUMENTATION.md, EASTER_DOCUMENTATION.md, STATIC_OFFICES_DOCUMENTATION.md, ORDINARY_TIME_DOCUMENTATION.md, BCP_PROPERS_DOCUMENTATION.md, SESSION_CHECKPOINT_2026-02-17.md, SESSION_CHECKPOINT_2026-02-17_evening.md) are OUT OF SYNC with the current codebase. They were written against the pre-modularization monolithic index.html and do not reflect: (1) the extraction of all UI logic into office-ui.js, (2) the modular calendar-engine.js and scripture-resolver.js architecture, (3) Phase 6.4 ecumenical devotion reorganization, (4) Phase 6.5 QC fixes including independent morning/evening reading chains, CalendarEngine.init() call sequence, sidebar #main-content toggle, Examen newline rendering, Theotokion two-step lookup, VARIABLE_ANTIPHON handler, or (5) the Transfiguration collect ID manual mapping. A full documentation rewrite session is required before Phase 7.0 begins.",
    "action_required": "Schedule a dedicated documentation rewrite session. Do not rely on existing .md files for architectural reference until rewritten.",
    "date_flagged": "2026-02-22"
  },
  "operational_status": "OPERATIONAL - Full BCP 1979 two-year lectionary cycle implemented. Modular architecture stable. Phase 6.5 QC fixes verified through full liturgical year stress test.",
  "goals": [
    "PRIMARY: Full alignment with BCP 1979 rubrics, lectionary, and liturgical structure with optional enhancements",
    "Offer customizable prayer experiences drawing from multiple Christian traditions to deepen users' spiritual lives",
    "Facilitate immersion in worship, bringing 'heaven to earth' through visual, auditory, and sensory elements",
    "Include a saints section with a curated kalendar based on Lesser Feasts and Fasts and the BCP, reviewed for marks of holiness and intercession",
    "Ensure the app is beautiful and engaging, changing with liturgical seasons to enhance the prayer experience",
    "FUTURE: Enable users to select Catholic, Orthodox, or Church of the East offices as alternative prayer modes",
    "Complete the 'Eight Books' of the Ethiopian New Testament church order",
    "Standardize all unique canonical IDs (e.g., 1MEQ, JUB, ASC_ISA, FETH_NAG, 3CO, 2BA, LAO) for global searchability"
  ],
  "completed_corrections": {
    "critical_completed": [
      {
        "issue": "One-year lectionary cycle vs. BCP 1979 two-year cycle",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "implementation": [
          "Created complete BCP 1979 Daily Office Lectionary for both Year One and Year Two",
          "Built 9 seasonal JSON files with dual-track reading fields:",
          "  - advent.json (26 entries, Nov 29 - Dec 24 MP)",
          "  - christmas.json (complete)",
          "  - epiphany.json (43 entries, Jan 6 - Feb 17, upgraded from v1 to v2 schema)",
          "  - lent.json (46 entries, Feb 18 - Apr 4)",
          "  - easter.json (50 entries, Apr 5 - May 24)",
          "  - ordinary1.json (68 entries, May 25 - Jul 31)",
          "  - ordinary2.json (61 entries, Aug 1 - Sep 30)",
          "  - ordinary3.json (59 entries, Oct 1 - Nov 28)",
          "  - static_offices.json (Noonday & Compline, year-round)",
          "Added Year One/Year Two reading fields to all entries",
          "Implemented automatic liturgical year detection (Year 1 = odd years, Year 2 = even, transitions at Advent)",
          "Year transition tested: Nov 28, 2026 (Year 2) → Nov 29, 2026 (Year 1) works correctly",
          "All 353 daily entries fully populated with both year tracks",
          "Schema v2 implemented: separate antiphon_mp and antiphon_ep fields, ISO date format (YYYY-MM-DD)",
          "20-field Eve schema for major feast eves (5 Eve entries total across all files)",
          "Verified against BCP 1979 Daily Office Lectionary tables (pp. 934-1001)"
        ],
        "files_created": [
          "data/season/advent.json",
          "data/season/epiphany.json (v2)",
          "data/season/lent.json",
          "data/season/easter.json",
          "data/season/ordinary1.json",
          "data/season/ordinary2.json",
          "data/season/ordinary3.json",
          "data/season/static_offices.json (v2)",
          "data/season/bcp-propers.json (Proper reference table)"
        ],
        "documentation_created": [
          "ADVENT_DOCUMENTATION.md (430 lines) — ⚠️ OUT OF SYNC, rewrite required",
          "EPIPHANY_DOCUMENTATION.md (463 lines) — ⚠️ OUT OF SYNC, rewrite required",
          "EASTER_DOCUMENTATION.md (complete) — ⚠️ OUT OF SYNC, rewrite required",
          "LENT_DOCUMENTATION.md (521 lines) — ⚠️ OUT OF SYNC, rewrite required",
          "STATIC_OFFICES_DOCUMENTATION.md (488 lines) — ⚠️ OUT OF SYNC, rewrite required",
          "ORDINARY_TIME_DOCUMENTATION.md (714 lines, covers all 3 files) — ⚠️ OUT OF SYNC, rewrite required",
          "BCP_PROPERS_DOCUMENTATION.md (519 lines) — ⚠️ OUT OF SYNC, rewrite required"
        ]
      },
      {
        "issue": "Modular architecture for maintainability",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "implementation": [
          "Created js/scripture-resolver.js (254 lines) — all scripture fetching logic",
          "Created js/calendar-engine.js (512 lines) — all date/calendar logic",
          "Created js/office-ui.js — all Daily Office UI logic extracted from index.html",
          "Reduced index.html to markup-only (~1165 lines)",
          "Implemented LRU cache for Bible books (max 20)",
          "Implemented Proper Jump calculation for Ordinary Time season start",
          "Added timezone normalization for date comparisons",
          "Created window.CalendarEngine global API with 10 public methods",
          "Created getScriptureText() global function for scripture fetching",
          "All functions tested and working in production"
        ],
        "architecture_improvements": [
          "Separation of concerns: index.html (markup only), office-ui.js (UI logic), scripture-resolver.js (scripture), calendar-engine.js (calendar)",
          "Reusable modules can be tested independently",
          "Scripture cache prevents redundant API calls",
          "Calendar engine handles all liturgical date calculations",
          "Modular design allows future expansion without monolithic file growth"
        ]
      },
      {
        "issue": "Sunday naming convention - Propers vs. Traditional numbering",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "implementation": [
          "Created bcp-propers.json reference file with Proper 1-29 date mappings",
          "getCurrentProper() function implemented in calendar-engine.js",
          "Proper numbers mapped to traditional Sunday names",
          "Display logic supports both naming conventions",
          "Edge cases handled (Trinity Sunday, Christ the King, displaced Sundays)"
        ]
      },
      {
        "issue": "Phase 6.4 — Ecumenical Devotions Organization and BCP-Only Mode",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-18",
        "implementation": [
          "Created Ecumenical Devotions UI section with tradition labels",
          "BCP Only Mode implemented with animated collapse",
          "Marian Antiphon and Theotokion consolidated into unified Marian Element selector (None/Antiphon/Theotokion/Both)",
          "All ecumenical devotions repositioned liturgically: Agpeya (opening), Trisagion (post-absolution), Angelus (pre-invitatory), CoE Prayer of Hours (closing)",
          "Assyrian Blessing removed (duplicate of BCP closing) — replaced with East Syriac Prayer of the Hours from Hudra tradition",
          "Jesus Prayer moved to Individual Prayers (Book of Needs)",
          "95% → 100% BCP office structure compliance achieved"
        ]
      },
      {
        "issue": "Phase 6.5 — QC Audit and Implementation Fixes",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-22",
        "verified_by": "Full liturgical year stress test",
        "implementation": [
          "office-ui.js / init(): CalendarEngine.init() now called after JSON data loads but before fetchLectionaryData()",
          "office-ui.js / renderOffice(): Reading resolution split into independent morning and evening chains (morningOT, morningEpistle, morningGospel vs. eveningOT, eveningEpistle, eveningGospel) — eliminates cross-contamination between MP and EP readings",
          "office-ui.js / toggleSidebar(): classList.toggle('sidebar-hidden') now applied to #main-content element in addition to #settings-panel",
          "office-ui.js / VARIABLE_COLLECT (Examen): examenComp.text now processed with .replace() to convert \\n\\n to <br><br>; injected into <div> with white-space:normal",
          "office-ui.js / Theotokion: Two-step lookup implemented — coptic-theotokion-${season} with fallback to coptic-theotokion",
          "office-ui.js / Rubric Loop: VARIABLE_ANTIPHON handler added for dynamic antiphon placement within the sequence loop",
          "office-ui.js / VARIABLE_COLLECT: Manual mapping added to redirect collect-transfiguration → collect-the-transfiguration-of-our-lord (naming mismatch fix)",
          "office.css / #main-content: transition: margin-left 0.3s ease added to base rule",
          "office.css / #main-content.sidebar-hidden: New rule added with margin-left: 36px"
        ]
      }
    ]
  },
  "immersive_features": {
    "visual": "Icons of saints, background colors, and themes that change with liturgical seasons based on seasonal JSON files and liturgicalColor field",
    "auditory": "Light background music or sounds to evoke a sacred atmosphere (pending implementation)",
    "sensory": "Design elements that evoke the atmosphere of traditional worship (e.g., imagery of incense)",
    "ui": "Immersive interface for web and mobile to create a 'heavenly worship' experience"
  },
  "technical_architecture": {
    "frontend": "Vanilla JavaScript with CSS custom properties for theming",
    "data_format": "Modular JSON structures for high-performance client-side rendering",
    "state_management": "In-memory session state with localStorage persistence for user preferences",
    "performance": "LRU cache for Bible text (max 20 books), lazy loading for seasonal data",
    "modularity": {
      "description": "Fully separated concerns across four files",
      "index_html": "Markup and DOM structure only (~1165 lines). Zero application logic.",
      "office_ui_js": {
        "path": "js/office-ui.js",
        "responsibility": "All Daily Office UI logic: init(), renderOffice(), toggleSidebar(), sequence loop, VARIABLE_* handlers, settings persistence, saints display, date controls",
        "last_modified": "2026-02-22",
        "status": "✅ CURRENT — reflects all Phase 6.5 QC fixes and stress-test verified"
      },
      "scripture_resolver_js": {
        "path": "js/scripture-resolver.js",
        "responsibility": "All scripture text fetching, citation parsing, LRU book cache, getScriptureText() global",
        "lines": 254,
        "last_modified": "2026-02-17",
        "status": "✅ CURRENT"
      },
      "calendar_engine_js": {
        "path": "js/calendar-engine.js",
        "responsibility": "All date/calendar logic: liturgical season detection, Year 1/2 calculation, Proper Jump, fetchLectionaryData(), window.CalendarEngine API",
        "lines": 512,
        "last_modified": "2026-02-17",
        "status": "✅ CURRENT",
        "note": "CalendarEngine.init() must be called explicitly in office-ui.js init() before fetchLectionaryData() — this sequence is now enforced as of Phase 6.5"
      },
      "office_css": {
        "path": "css/office.css",
        "responsibility": "All application styles including seasonal theming, sidebar, main content, print styles",
        "last_modified": "2026-02-22",
        "status": "✅ CURRENT — #main-content transition and .sidebar-hidden rule added in Phase 6.5"
      }
    },
    "entry_point": "index.html with modular script imports"
  },
  "content_status": {
    "psalter": {
      "canonical_psalms": "1-150 (Completed)",
      "historical_psalms": "151-155 (Completed: Syriac Peshitta lectionary alignment verified)",
      "total_entries": 155,
      "source_text": "NRSV / Traditional liturgical translations",
      "status": "Fully verified and integrated into data/bible/OT/psalms.json"
    },
    "ethiopic_pillar": {
      "historical_legal": "Completed: Didaskalia, Fetha Nagast (Full), Nicaea, Josippon (Full)",
      "prophetic_wisdom": "Completed: 1 Enoch, Jubilees, Ascension of Isaiah, Rest of Baruch, Rest of Jeremiah, 1-3 Meqa'abyan",
      "patristic_pillar": "Completed: 1-8 Clement (Ethiopic), Shepherd of Hermas",
      "new_testament_eight_books": "Completed: Sirate Tsion, Tizaz, Gitsiw, Abtilis, I-IV Qalëmentos (Visionary, Rolls, and Statute Recensions)",
      "marian_narrative": "Completed: Täʾamrä Maryam (Miracles of Mary) - 100 Miracles (Volumes I & II Combined)",
      "hymnody": "Completed: Malke'a Mariam, Malke'a Iyasus, Malke'a Guba'e (Full Salutation Cycle Finished)"
    },
    "global_expansion": {
      "syriac_tradition": "Completed: 2 Baruch, 5 Maccabees (Syriac), Letter of Baruch, Odes of Solomon, Psalms 152-155 (Peshitta), History of Zosimus",
      "armenian_tradition": "Completed: 3 Corinthians, Prayer of Apollonius, Armenian Canticles",
      "eastern_orthodox": "Completed: Nine Biblical Odes (Septuagint Basis)",
      "coptic_tradition": "Completed: Four Hoos (Coptic Odes)",
      "western_apocrypha": "Completed: Epistle to the Laodiceans"
    },
    "liturgy": {
      "morning_prayer": "✅ Fully operational with Year One/Year Two lectionary implemented",
      "evening_prayer": "✅ Fully operational with Phos Hilaron, Magnificat, and Year One/Year Two lectionary",
      "compline": "✅ Fully operational with Nunc Dimittis (static office)",
      "noonday_prayer": "✅ Fully operational (static office)",
      "customization": "Gospel placement (Morning/Evening/Both), 30-day Psalter option, Great Litany, Suffrages, Creed selection, Liturgical year auto-detection"
    },
    "collects_and_special": {
      "daily_collects": "✅ Completed - collect IDs standardized across seasonal files and linked to components.json",
      "seasonal_antiphons": "✅ Implemented via antiphon_mp and antiphon_ep fields in seasonal JSONs (v2 schema)",
      "canticles": "✅ Fully integrated: Magnificat, Nunc Dimittis, Te Deum, Benedictus, Phos Hilaron",
      "collect_id_mappings": "Manual mapping in office-ui.js VARIABLE_COLLECT handler: collect-transfiguration → collect-the-transfiguration-of-our-lord"
    },
    "saints_kalendar": {
      "status": "✅ Complete for January through December with dynamic monthly loading",
      "implementation": "Automatically loads data/saints/saints-<month>.json based on current date"
    },
    "seasonal_propers": {
      "status": "✅ Complete through liturgical year 2030",
      "coverage": "Advent, Christmas, Epiphany, Lent, Easter, Ordinary Time (subdivided into 3 files)",
      "lectionary": "✅ IMPLEMENTED: BCP 1979 Daily Office Lectionary with Year One and Year Two tracks"
    }
  },
  "roadmap": {
    "completed_phases": [
      {
        "phase": "6.1 - BCP Lectionary Compliance",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "delivered": [
          "Complete BCP 1979 Daily Office Lectionary structure documented",
          "Year One and Year Two reading tables implemented in 9 JSON files",
          "Dual-year lectionary data structure finalized (v2 schema)",
          "Year selection logic implemented with automatic calculation",
          "All seasonal JSON files updated with Year One and Year Two fields",
          "Year switching tested and verified",
          "Random date sampling verified against printed BCP 1979",
          "353 total daily entries covering complete liturgical year",
          "7 comprehensive documentation files created (3,135 lines total)"
        ]
      },
      {
        "phase": "6.2 - Sunday Naming Enhancement",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "delivered": [
          "bcp-propers.json created with Proper 1-29 mappings",
          "getCurrentProper() function implemented in calendar-engine.js",
          "Proper numbers mapped to traditional Sunday names",
          "Display logic supports both naming conventions",
          "Edge cases handled (Trinity Sunday, Christ the King, displaced Sundays)"
        ]
      },
      {
        "phase": "6.3 - Code Modularization",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-17",
        "delivered": [
          "scripture-resolver.js module created (254 lines)",
          "calendar-engine.js module created (512 lines)",
          "office-ui.js module created — all Daily Office UI logic",
          "index.html reduced to markup only (~1165 lines)",
          "LRU cache implemented for Bible books",
          "Proper Jump algorithm implemented",
          "Liturgical year auto-detection implemented",
          "All modules tested and production-ready"
        ]
      },
      {
        "phase": "6.4 - Devotional Organization",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-18",
        "tasks": [
          "✅ Created 'Ecumenical Devotions' section with tradition labels",
          "✅ Moved all non-BCP prayers to labeled subsections (Catholic, Byzantine Orthodox, Oriental Orthodox, Church of the East, Coptic)",
          "✅ Implemented BCP Only Mode toggle with animated collapse",
          "✅ Consolidated Marian Antiphon and Theotokion into single Marian Element selector (None/Antiphon/Theotokion/Both)",
          "✅ Implemented positional placement for all ecumenical devotions (Agpeya=opening, Trisagion=post-absolution, Angelus=pre-invitatory, Assyrian/CoE=closing)",
          "✅ Replaced Assyrian Blessing (duplicate of BCP closing) with East Syriac Prayer of the Hours (Hudra tradition)",
          "✅ Moved Jesus Prayer to Individual Prayers section",
          "✅ 95% → 100% BCP office structure compliance achieved"
        ]
      },
      {
        "phase": "6.5 - QC Audit and Implementation Fixes",
        "status": "✅ COMPLETED",
        "completion_date": "2026-02-22",
        "verification": "Full liturgical year stress test passed",
        "tasks": [
          "✅ CalendarEngine.init() call sequencing enforced in init()",
          "✅ Independent morning/evening reading chains — cross-contamination eliminated",
          "✅ Sidebar toggle propagates sidebar-hidden to #main-content",
          "✅ Examen text newline rendering fixed (\\n\\n → <br><br>, white-space:normal)",
          "✅ Theotokion two-step seasonal lookup with generic fallback",
          "✅ VARIABLE_ANTIPHON rubric loop handler implemented",
          "✅ Transfiguration collect ID naming mismatch resolved (manual mapping)",
          "✅ CSS: #main-content transition and sidebar-hidden margin rule added"
        ]
      }
    ],
    "immediate_priorities": [
      {
        "phase": "6.6 - Documentation Rewrite",
        "status": "⚠️ REQUIRED BEFORE PHASE 7.0",
        "priority": "HIGH",
        "description": "All external documentation files are out of sync with the modularized codebase. A full rewrite session is required covering the new four-file architecture, all Phase 6.5 fixes, and the current office-ui.js sequence logic.",
        "tasks": [
          "Rewrite ADVENT_DOCUMENTATION.md to reflect office-ui.js architecture",
          "Rewrite EPIPHANY_DOCUMENTATION.md",
          "Rewrite LENT_DOCUMENTATION.md",
          "Rewrite EASTER_DOCUMENTATION.md",
          "Rewrite STATIC_OFFICES_DOCUMENTATION.md",
          "Rewrite ORDINARY_TIME_DOCUMENTATION.md",
          "Rewrite BCP_PROPERS_DOCUMENTATION.md",
          "Create new SESSION_CHECKPOINT_2026-02-22.md covering Phase 6.5 completion",
          "Document VARIABLE_ANTIPHON handler and Theotokion two-step lookup pattern",
          "Document CalendarEngine.init() call sequence requirement"
        ]
      },
      {
        "phase": "6.7 - Performance & Polish",
        "tasks": [
          "Fix timezone comparison warning in calendar-engine.js (in progress)",
          "Add LRU eviction to seasonal file cache",
          "Optimize initial page load time",
          "Add prefetching for next/prev days",
          "Implement service worker for offline support"
        ],
        "estimated_duration": "1 week",
        "priority": "MEDIUM",
        "status": "PARTIALLY COMPLETE"
      }
    ],
    "future_phases": [
      {
        "phase": "7.0 - Multi-Tradition Architecture",
        "description": "Full canonical hours for Eastern, Oriental, and Church of the East traditions — modular and mix-and-match capable",
        "prerequisites": [
          "Complete BCP implementation ✅",
          "Stable architecture ✅",
          "Documentation rewrite ⚠️ REQUIRED FIRST"
        ],
        "priority": "MEDIUM",
        "status": "READY TO BEGIN — pending documentation rewrite",
        "architectural_plan": {
          "approach": "Separate rubric files per tradition, same component lookup system, mode selector on splash screen",
          "traditions": [
            {
              "tradition": "Byzantine Orthodox",
              "hours": [
                "Orthros (Matins)",
                "First Hour",
                "Third Hour",
                "Sixth Hour",
                "Ninth Hour",
                "Vespers",
                "Compline (Apodeipnon)",
                "Midnight Office"
              ],
              "distinctive_elements": [
                "Troparion/Kontakion system",
                "Full Byzantine Opening (Trisagion Prayers)",
                "Theotokion at each hour",
                "Psalm 103 at Vespers",
                "Hexapsalmos at Orthros"
              ],
              "component_needs": [
                "byzantine-opening-full",
                "troparia-seasonal",
                "kontakia-seasonal",
                "orthros-canons",
                "vespers-lamp-lighting"
              ],
              "data_files": "rubrics/byzantine-*.json + components/byzantine-*.json",
              "status": "PLANNED"
            },
            {
              "tradition": "Coptic Orthodox",
              "hours": [
                "Agpeya: Prime",
                "Terce",
                "Sext",
                "None",
                "Vespers",
                "Compline",
                "Midnight"
              ],
              "distinctive_elements": [
                "Agpeya structure",
                "Theotokia (seasonal Marian hymns)",
                "Lobsh (Psalm commentaries)",
                "Fraction prayers",
                "Doxologies of the saints"
              ],
              "component_needs": [
                "agpeya-full-hour-structure",
                "theotokia-seasonal",
                "lobsh-texts",
                "coptic-doxologies"
              ],
              "data_files": "rubrics/coptic-*.json + components/coptic-*.json",
              "status": "PLANNED"
            },
            {
              "tradition": "Church of the East (Hudra)",
              "hours": [
                "Ramsha (Vespers)",
                "Lilya (Night Office)",
                "Sapra (Matins/Lauds)"
              ],
              "distinctive_elements": [
                "East Syriac chant tradition",
                "Hymns of Ephrem the Syrian",
                "Prayer of the Hours (already implemented as ecumenical element)",
                "Gloria in excelsis at Sapra on feasts",
                "Office sung in churchyard Ascension-November"
              ],
              "component_needs": [
                "east-syriac-ramsha",
                "east-syriac-lilya",
                "east-syriac-sapra",
                "ephrem-hymns-seasonal"
              ],
              "data_files": "rubrics/east-syriac-*.json + components/east-syriac-*.json",
              "status": "PARTIAL — Prayer of the Hours live as ecumenical element"
            },
            {
              "tradition": "Oriental Orthodox (Ethiopian/Eritrean)",
              "hours": [
                "Ge'ez Divine Office — seven hours"
              ],
              "distinctive_elements": [
                "Predominantly Psalms",
                "Marian office (Wudase Maryam)",
                "Mezmur (sacred song) tradition",
                "Distinct Psalm numbering (151 Psalms)"
              ],
              "component_needs": [
                "ethiopian-hours-structure",
                "wudase-maryam",
                "mezmur-seasonal"
              ],
              "data_files": "rubrics/ethiopian-*.json + components/ethiopian-*.json",
              "status": "PLANNED"
            }
          ],
          "ui_changes": [
            "Splash screen mode selector expanded: Daily Office (BCP) / Byzantine Hours / Coptic Agpeya / East Syriac Hours / Ethiopian Hours / Custom Mix",
            "Custom Mix mode: user selects opening tradition, psalm cycle, canticle tradition, closing tradition independently",
            "Seasonal data files needed per tradition for troparia/kontakia/theotokia"
          ],
          "estimated_scope": "LARGE — 4-6 months, multiple new JSON data files, significant rubric expansion"
        }
      },
      {
        "phase": "8.0 - Mobile App Development",
        "description": "Native iOS and Android apps with offline capability and push notifications for prayer times",
        "prerequisites": [
          "Stable web application ✅"
        ],
        "priority": "LOW",
        "status": "READY TO BEGIN"
      }
    ]
  },
  "files_structure": {
    "root": [
      "index.html (~1165 lines, markup and DOM structure only — zero application logic)"
    ],
    "javascript_modules": [
      "js/office-ui.js — Daily Office UI logic: init(), renderOffice(), toggleSidebar(), sequence loop, all VARIABLE_* handlers, settings, saints, date controls (last modified: 2026-02-22)",
      "js/scripture-resolver.js (254 lines, Bible text fetching and citation parsing, last modified: 2026-02-17)",
      "js/calendar-engine.js (512 lines, date & lectionary logic, window.CalendarEngine API, last modified: 2026-02-17)",
      "js/prayers.js — Book of Needs prayer rendering",
      "js/tooltip.js — Info tooltip system"
    ],
    "css": [
      "css/office.css — all application styles (last modified: 2026-02-22)"
    ],
    "data_root": [
      "data/README.md",
      "data/components.json",
      "data/rubrics.json",
      "data/structure.json"
    ],
    "documentation": [
      "ADVENT_DOCUMENTATION.md (430 lines) — ⚠️ OUT OF SYNC",
      "EPIPHANY_DOCUMENTATION.md (463 lines) — ⚠️ OUT OF SYNC",
      "EASTER_DOCUMENTATION.md (complete) — ⚠️ OUT OF SYNC",
      "LENT_DOCUMENTATION.md (521 lines) — ⚠️ OUT OF SYNC",
      "STATIC_OFFICES_DOCUMENTATION.md (488 lines) — ⚠️ OUT OF SYNC",
      "ORDINARY_TIME_DOCUMENTATION.md (714 lines) — ⚠️ OUT OF SYNC",
      "BCP_PROPERS_DOCUMENTATION.md (519 lines) — ⚠️ OUT OF SYNC",
      "SESSION_CHECKPOINT_2026-02-17.md (197 lines) — ⚠️ OUT OF SYNC",
      "SESSION_CHECKPOINT_2026-02-17_evening.md (321 lines) — ⚠️ OUT OF SYNC"
    ],
    "bible_library": {
      "NT": [
        "data/bible/NT/*.json (27 canonical + apocryphal books)"
      ],
      "OT": [
        "data/bible/OT/*.json (39 canonical + deuterocanonical + apocryphal books)"
      ],
      "ET": [
        "data/bible/ET/*.json (Ethiopian Orthodox broader canon)"
      ],
      "SY": [
        "data/bible/SY/*.json (Syriac tradition texts)"
      ],
      "AR": [
        "data/bible/AR/*.json (Armenian tradition texts)"
      ],
      "ODES": [
        "data/bible/ODES/*.json (Biblical canticles and odes)"
      ]
    },
    "saints": [
      "data/saints/saints-january.json",
      "data/saints/saints-february.json",
      "data/saints/saints-march.json",
      "data/saints/saints-april.json",
      "data/saints/saints-may.json",
      "data/saints/saints-june.json",
      "data/saints/saints-july.json",
      "data/saints/saints-august.json",
      "data/saints/saints-september.json",
      "data/saints/saints-october.json",
      "data/saints/saints-november.json",
      "data/saints/saints-december.json"
    ],
    "season": [
      "data/season/advent.json (26 entries)",
      "data/season/christmas.json",
      "data/season/epiphany.json (43 entries, v2 schema)",
      "data/season/lent.json (46 entries)",
      "data/season/easter.json (50 entries)",
      "data/season/ordinary1.json (68 entries, May 25-Jul 31)",
      "data/season/ordinary2.json (61 entries, Aug 1-Sep 30)",
      "data/season/ordinary3.json (59 entries, Oct 1-Nov 28)",
      "data/season/static_offices.json (Noonday & Compline, v2 schema)",
      "data/season/bcp-propers.json (Proper 1-29 reference table)"
    ]
  },
  "recent_updates": [
    {
      "date": "2026-02-22",
      "version": "2.4.0",
      "category": "Phase 6.5 QC Implementation — Stress Test Verified",
      "changes": [
        "✅ office-ui.js extracted from index.html — all Daily Office UI logic now modular",
        "✅ CalendarEngine.init() call sequencing enforced in init() before fetchLectionaryData()",
        "✅ renderOffice(): independent morning/evening reading resolution chains implemented — cross-contamination between MP and EP readings eliminated",
        "✅ toggleSidebar(): #main-content.sidebar-hidden class toggle added",
        "✅ VARIABLE_COLLECT / Examen: \\n\\n converted to <br><br>, rendered in <div> with white-space:normal",
        "✅ Theotokion: two-step lookup (coptic-theotokion-${season} with fallback to coptic-theotokion)",
        "✅ Rubric loop: VARIABLE_ANTIPHON handler added for dynamic in-sequence antiphon placement",
        "✅ VARIABLE_COLLECT: manual mapping collect-transfiguration → collect-the-transfiguration-of-our-lord",
        "✅ office.css: #main-content transition: margin-left 0.3s ease added",
        "✅ office.css: #main-content.sidebar-hidden { margin-left: 36px } added",
        "⚠️ Documentation debt flag raised: all .md documentation files are out of sync with modularized architecture"
      ]
    },
    {
      "date": "2026-02-18",
      "changes": [
        "Phase 6.4 COMPLETED: Ecumenical Devotions UI reorganized with tradition labels",
        "BCP Only Mode implemented with animated collapse",
        "Marian Antiphon and Theotokion consolidated into unified Marian Element selector (4 options)",
        "All ecumenical devotions repositioned liturgically: Agpeya (opening), Trisagion (post-absolution), Angelus (pre-invitatory), CoE Prayer of Hours (closing)",
        "Assyrian Blessing removed (duplicate of BCP closing) — replaced with East Syriac Prayer of the Hours from Hudra tradition",
        "Jesus Prayer moved to Individual Prayers",
        "Phase 7.0 architectural plan documented: Byzantine, Coptic, Church of the East, Ethiopian hours"
      ]
    },
    {
      "date": "2026-02-17",
      "version": "2.2.0",
      "category": "BCP Lectionary Implementation Complete + Modularization",
      "changes": [
        "✅ COMPLETED: Full BCP 1979 two-year lectionary cycle implementation",
        "✅ Created 9 seasonal JSON files with 353 total entries",
        "✅ Implemented Year One and Year Two dual-track reading fields",
        "✅ Added automatic liturgical year detection (Year 1/Year 2 transition at Advent)",
        "✅ Upgraded epiphany.json and static_offices.json from v1 to v2 schema",
        "✅ Implemented 20-field Eve schema for major feast eves (5 entries)",
        "✅ Created comprehensive documentation (7 files, 3,135 lines)",
        "✅ Modularized codebase: extracted scripture-resolver.js (254 lines) and calendar-engine.js (512 lines)",
        "✅ Implemented Proper Jump calculation for Ordinary Time",
        "✅ Reduced index.html from 1240 to ~1165 lines",
        "✅ Added LRU cache for Bible books (max 20)",
        "✅ Verified all readings against BCP 1979 pp. 934-1001",
        "⚠️ Minor timezone comparison warning (non-breaking, being debugged)"
      ]
    },
    {
      "date": "2026-02-15",
      "version": "2.1.0",
      "category": "BCP Compliance Review and Roadmap Update",
      "changes": [
        "CRITICAL FINDING: Identified one-year lectionary cycle as departure from BCP 1979 two-year cycle",
        "Updated goals to emphasize PRIMARY goal of full BCP alignment with optional enhancements",
        "Added priority_corrections_needed section with actionable tasks",
        "Created bcp_compliance_status tracking system",
        "Documented need for dual Sunday naming (Propers + Traditional)",
        "Clarified that Eastern Orthodox devotions are enhancements, not replacements",
        "Updated roadmap with immediate priorities focusing on BCP compliance",
        "Established 'BCP-plus' philosophy: 100% BCP compliant with clearly marked optional additions"
      ]
    },
    {
      "date": "2026-02-14",
      "version": "2.0.0",
      "category": "Production Release",
      "fixes": [
        "Fix #1: Bible Reader Mode - Implemented complete navigation system for canonical Bible books with chapter/verse selection",
        "Fix #2: Memory Management - Added LRU cache limiting to 20 most recent Bible books to prevent memory bloat",
        "Fix #3: Lazy Loading - Seasonal data loads on-demand rather than at initialization",
        "Fix #4: Loading Indicators - Added visual feedback during scripture fetching and office rendering",
        "Fix #5: Date Handling - Implemented timezone-aware date parsing to prevent date shifting",
        "Fix #6: Psalm Range Parsing - Fixed support for complex psalm ranges like '110:1-5(6-7)'",
        "Fix #7: Scripture Reference Case Sensitivity - Standardized book ID matching (uppercase)",
        "Fix #8: Proper Seasonal Antiphons - Fixed seasonal antiphon selection logic",
        "Fix #9: Canticle Rendering - Consolidated canticle display logic (Te Deum, Magnificat, etc.)",
        "Fix #10: Gospel Placement Logic - Added flexible positioning (Morning/Evening/Both)",
        "Fix #11: Marian Antiphon Positioning - Implemented before/after/none positioning options",
        "Fix #12: Settings Persistence - Implemented localStorage-based persistence for all user preferences",
        "Fix #13: Error Handling Standardization - Unified error handling with graceful degradation",
        "Fix #14: Print Styles - Added comprehensive @media print styles for clean paper output"
      ]
    },
    {
      "date": "2026-02-12",
      "version": "1.7.0",
      "category": "File System Redesign",
      "fixes": [
        "Consolidated Marian logic",
        "Refined Scripture Rendering with verse number stripping",
        "Updated seasonal JSON keys to standardized format",
        "Added Gospel placement settings",
        "Added navigation buttons to all modes",
        "Fixed reference case-sensitivity issues",
        "Implemented BCP three-lesson structure flexibility",
        "Verified all 155 Psalms pulling correctly",
        "Migrated from deprecated propers.json to seasonal JSON files",
        "Standardized Collect IDs across all files",
        "Implemented 30-day Psalm cycle",
        "Updated dynamic monthly saints loading",
        "Expanded Ethiopian Broader Canon",
        "Transcribed Miracles of Mary and Malke'a cycle",
        "Redesigned file system into specialized subdirectories",
        "Integrated Syriac, Armenian, Greek (EO), and Coptic scripture files",
        "Corrected Psalter numbering (Psalms 151-155)"
      ]
    }
  ],
  "lessons_learned": [
    {
      "lesson": "BCP Compliance is Primary",
      "description": "The stated goal is FULL BCP 1979 alignment with enhancements. Any departure from BCP (like using one-year vs. two-year lectionary) is a bug, not a feature. Must correct immediately.",
      "date_added": "2026-02-15",
      "status": "✅ RESOLVED - Two-year lectionary fully implemented"
    },
    {
      "lesson": "Modular Architecture Enables Maintainability",
      "description": "Separating scripture fetching and calendar logic into standalone modules significantly improves code maintainability, testability, and future extensibility. Monolithic files become unmanageable above 1000 lines.",
      "date_added": "2026-02-17"
    },
    {
      "lesson": "Documentation is Critical for Complex Systems",
      "description": "Comprehensive documentation is essential for a system with 353 lectionary entries. Documentation should cover schema, edge cases, validation checklists, and testing scenarios. Documentation must be updated in sync with code changes — allowing it to fall out of sync creates dangerous technical debt.",
      "date_added": "2026-02-17",
      "status": "⚠️ Documentation currently OUT OF SYNC — rewrite required"
    },
    {
      "lesson": "Session Checkpoints Enable Recovery",
      "description": "Detailed checkpoint files capturing completed work, current state, and next steps enable seamless recovery when sessions are interrupted or when collaborating with multiple AI assistants.",
      "date_added": "2026-02-17"
    },
    {
      "lesson": "Timezone Normalization is Essential",
      "description": "Date comparisons must use timezone-normalized dates (stripTime helper) to prevent off-by-one errors. New Date('YYYY-MM-DD') is interpreted as UTC midnight, while new Date() is local midnight.",
      "date_added": "2026-02-17"
    },
    {
      "lesson": "Clear Enhancement Labeling",
      "description": "All non-BCP elements (Eastern prayers, expanded canon, etc.) must be clearly labeled as enhancements and optional. Users should be able to have a 'pure BCP' experience.",
      "date_added": "2026-02-15",
      "status": "✅ IMPLEMENTED"
    },
    {
      "lesson": "Dual Naming Systems",
      "description": "Support both modern BCP terminology (Propers) and traditional Anglican terminology (numbered Sundays) as both are in common use.",
      "date_added": "2026-02-15",
      "status": "✅ IMPLEMENTED"
    },
    {
      "lesson": "Consolidation of shared saints/feasts",
      "description": "Consolidate shared saints to 'tradition': 'Universal' to eliminate redundancy."
    },
    {
      "lesson": "Anglican saint selection process",
      "description": "Vetted via BCP/LFF criteria; Explicit Protestant reformers removed unless overridden."
    },
    {
      "lesson": "No simulations",
      "description": "Always use real tool calls for verification. Never assume or guess file contents."
    },
    {
      "lesson": "Lectionary adherence",
      "description": "Strictly use 1979 BCP Daily Office Lectionary (Year One/Two cycle).",
      "status": "✅ IMPLEMENTED"
    },
    {
      "lesson": "JSON integrity and No Truncation",
      "description": "Never truncate structure.json. Loss of structural steps or lessons learned blocks project roadmap."
    },
    {
      "lesson": "Lectionary shorthand and choice handling",
      "description": "For BCP shorthand like 'Isaiah 58:1-9A(9B-12)', always use the full reading (58:1-12)."
    },
    {
      "lesson": "Pillar Priority",
      "description": "Ensure the BCP 1979 core functionality is fully operational before integrating broader tradition logic.",
      "status": "✅ COMPLETE - BCP core at 100% compliance"
    },
    {
      "lesson": "Path Management",
      "description": "Any change to directory structure must be immediately followed by pathing logic updates."
    },
    {
      "lesson": "Incremental Testing",
      "description": "Fix issues incrementally with testing between changes rather than multiple simultaneous fixes."
    },
    {
      "lesson": "Performance Optimization",
      "description": "Implement resource limits (LRU caches, lazy loading) early to prevent performance degradation.",
      "status": "✅ IMPLEMENTED"
    },
    {
      "lesson": "User Experience First",
      "description": "Loading indicators, error handling, and settings persistence significantly improve satisfaction."
    },
    {
      "lesson": "Print Media Consideration",
      "description": "For liturgical applications, print output is critical - users want hard copies for offline prayer."
    },
    {
      "lesson": "Multi-AI Collaboration Works",
      "description": "Dividing work between Claude (architecture/documentation) and Gemini (debugging/optimization) based on each AI's strengths and token limits is highly effective. User acts as tech lead coordinating both.",
      "date_added": "2026-02-17"
    },
    {
      "lesson": "QC Audits Require Independent Reading Chains",
      "description": "When a single data set (daily lectionary entry) serves both Morning and Evening Prayer, reading resolution logic must be split into completely independent chains per office. Shared intermediate variables cause cross-contamination where EP keys pollute MP resolution and vice versa.",
      "date_added": "2026-02-22"
    },
    {
      "lesson": "Collect ID Naming Consistency",
      "description": "Collect IDs in seasonal JSON files must exactly match component IDs in components.json. Where legacy mismatches exist (e.g., collect-transfiguration vs. collect-the-transfiguration-of-our-lord), add explicit manual mappings in the VARIABLE_COLLECT handler rather than silently failing.",
      "date_added": "2026-02-22"
    },
    {
      "lesson": "CalendarEngine Initialization Sequence",
      "description": "CalendarEngine.init() must be called explicitly in office-ui.js init() after JSON data loads and before fetchLectionaryData(). Relying on implicit initialization causes race conditions with bcp-propers.json loading.",
      "date_added": "2026-02-22"
    }
  ],
  "technical_improvements": {
    "memory_management": "LRU cache limits Bible books to 20 most recently used, preventing memory bloat on mobile devices",
    "state_persistence": "All user preferences saved to localStorage and restored on session start",
    "lazy_loading": "Daily Office data only loads when needed, reducing initial page load time",
    "error_resilience": "Standardized error handling with graceful degradation when scripture unavailable",
    "date_handling": "Timezone-aware date parsing prevents date shifting across different locales",
    "print_optimization": "Clean print styles remove UI chrome and optimize typography for paper",
    "modular_architecture": "Four-file separation: index.html (markup), office-ui.js (UI logic), scripture-resolver.js (254 lines, scripture fetching), calendar-engine.js (512 lines, calendar logic)",
    "liturgical_year_detection": "Automatic calculation of Year 1/Year 2 based on Advent Sunday (4th Sunday before Christmas)",
    "proper_jump_algorithm": "Calculates correct starting Proper for Ordinary Time based on variable Pentecost date",
    "caching_strategy": "Two-tier cache: Bible books (LRU, 20 max) and seasonal files (unlimited, lazy-loaded)",
    "reading_chain_isolation": "Independent morning/evening reading resolution chains prevent cross-contamination in dual-track lectionary",
    "sidebar_toggle": "Full sidebar hide/show propagates to both #settings-panel and #main-content with CSS transition"
  },
  "known_limitations": {
    "calendar_range": "Liturgical season dates hardcoded through 2030; will require update for 2031+",
    "browser_storage": "localStorage has ~5-10MB limit; settings and cache stay well under this threshold",
    "offline_capability": "Requires initial online load; subsequent usage works offline once data cached",
    "mobile_optimization": "Responsive design works on mobile but lacks native app features (gestures, notifications)",
    "timezone_warnings": "Minor console warnings for date format checking (non-breaking, being debugged)",
    "documentation_debt": "All .md documentation files are out of sync with current modularized architecture — HIGH PRIORITY for next session"
  },
  "deployment_notes": {
    "hosting_requirements": "Static hosting sufficient (GitHub Pages, Netlify, Vercel)",
    "dependencies": "None - vanilla JavaScript with no external libraries",
    "browser_compatibility": "Modern browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)",
    "performance": "Lightweight: Initial load ~500KB, subsequent loads use browser cache",
    "module_support": "Requires ES6 module support (all modern browsers)",
    "hard_refresh_needed": "Cache-busting requires Ctrl+Shift+R / Cmd+Shift+R after module updates"
  },
  "api_documentation": {
    "scripture_resolver": {
      "function": "getScriptureText(citation)",
      "description": "Fetches and returns scripture text for BCP-style citations",
      "examples": [
        "getScriptureText('Isaiah 40:12-23')",
        "getScriptureText('Psalm 119:105-112')",
        "getScriptureText('Psalm 42, Psalm 43')",
        "getScriptureText('Joel 2:1-2, 12-17')"
      ],
      "cache": "LRU cache (20 books max)"
    },
    "calendar_engine": {
      "global": "window.CalendarEngine",
      "initialization_note": "CalendarEngine.init() must be called explicitly in office-ui.js init() before fetchLectionaryData(). This loads bcp-propers.json and prepares the engine.",
      "methods": [
        "init() - Initialize engine and load bcp-propers.json",
        "getCurrentDate() - Get current date",
        "setCurrentDate(date) - Set current date",
        "changeDate(days) - Add/subtract days from current date",
        "resetDate() - Reset to today",
        "getLiturgicalYear(date) - Returns 1 or 2",
        "getSeasonAndFile(date) - Returns {season, file, liturgicalColor, litYear}",
        "getCurrentProper(date) - Returns Proper number (3-29)",
        "fetchLectionaryData(date) - Returns daily entry object",
        "formatDateForLookup(date) - Returns 'February 17, 2026'",
        "formatDateISO(date) - Returns '2026-02-17'"
      ]
    },
    "office_ui_key_handlers": {
      "VARIABLE_OPENING": "Resolves bcp-opening-${season} with fallback to bcp-opening-general",
      "VARIABLE_ANTIPHON": "Resolves antiphon_mp or antiphon_ep from dailyData based on isMorning flag",
      "VARIABLE_PSALM": "Renders appointed psalms with Gloria Patri if enabled",
      "VARIABLE_READING_OT": "Renders OT lesson from independent morning or evening chain",
      "VARIABLE_READING_EPISTLE": "Renders Epistle from independent morning or evening chain",
      "VARIABLE_READING_GOSPEL": "Renders Gospel from independent morning or evening chain, subject to gospelPlacement setting",
      "VARIABLE_CANTICLE1": "Te Deum (MP) or Magnificat (EP)",
      "VARIABLE_CANTICLE2": "Benedictus (MP) or Nunc Dimittis (EP)",
      "VARIABLE_COLLECT": "Resolves collect ID from dailyData with manual mapping fallbacks (e.g., Transfiguration); also triggers Examen (Compline) and Kyrie Pantocrator if enabled"
    }
  },
  "collaboration_notes": {
    "ai_team": {
      "claude": {
        "role": "Architecture, Documentation, High-level design, QC audit and implementation directives",
        "strengths": "Structured thinking, comprehensive documentation, system design, targeted diff generation",
        "limitations": "Weekly token limit (~190k tokens)"
      },
      "gemini": {
        "role": "Debugging, Optimization, Iterative fixes",
        "strengths": "Unlimited iteration capacity, syntax debugging, performance tuning",
        "limitations": "None reported by user"
      }
    },
    "workflow": {
      "description": "User acts as tech lead, coordinating between Claude and Gemini based on task requirements and each AI's strengths",
      "benefits": [
        "Claude handles architecture without being slowed by debugging iterations",
        "Gemini handles debugging without token budget concerns",
        "User maintains project vision and coordinates efforts",
        "Session checkpoints enable seamless handoffs between AIs"
      ]
    }
  },
  "metrics": {
    "total_lines_of_code": "~2300 estimated (index.html: ~1165 markup, office-ui.js: ~850, scripture-resolver.js: 254, calendar-engine.js: 512)",
    "total_documentation_lines": "3,653 (7 lectionary docs: 3,135, 2 session checkpoints: 518) — ⚠️ all out of sync",
    "total_lectionary_entries": "353 (across 9 seasonal JSON files)",
    "total_bible_books": "155+ (canonical + deuterocanonical + apocryphal + broader canon)",
    "total_saint_commemorations": "365+ (12 monthly files)",
    "bcp_compliance_percentage": "100%",
    "code_reduction_from_modularization": "75 lines net (was 1240, now 1165 markup + 1616 modules)",
    "phase_65_fixes_applied": 9
  },
  "last_updated": "2026-02-22"
}